<!DOCTYPE html>
<html lang="fr">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Flashcards</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

:root{--main:#6c63ff}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,Segoe UI;
background:linear-gradient(160deg,#0f1222,#1c1f3a);
height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:white;
}

.app{width:100%;max-width:420px;padding:20px}

.sheetBar{display:flex;gap:8px;overflow-x:auto;margin-bottom:10px}

.sheetBtn{
padding:8px 12px;
border-radius:12px;
background:#ffffff20;
border:none;
color:white;
}

.sheetBtn.active{background:var(--main)}

.card{
background:white;
border-radius:22px;
padding:25px;
text-align:center;
min-height:180px;
display:flex;
flex-direction:column;
justify-content:center;
font-size:30px;
color:#111;
}

.word{color:var(--main)}
.translation{font-size:22px;margin-top:8px}

.controls,.row{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:10px;
margin-top:12px;
}

button{
border:none;
border-radius:14px;
padding:14px;
background:#ffffff20;
color:white;
font-size:18px;
}

.favorite{background:gold;color:black}

.example{margin-top:10px;font-size:14px;opacity:.8;min-height:40px}
.counter{text-align:center;margin-top:6px;font-size:13px;opacity:.6}

</style>
</head>

<body>

<div class="app">

<input type="file" id="upload">

<div id="sheetBar" class="sheetBar"></div>

<div id="card" class="card">
<div id="front" class="word">Charge ton Excel</div>
<div id="back" class="translation"></div>
</div>

<div class="controls">
<button onclick="prev()">â¬…</button>
<button onclick="speak()">ğŸ”Š</button>
<button onclick="next()">â¡</button>
<button id="favBtn" onclick="toggleFavorite()">â­</button>
</div>

<div class="row">
<button onclick="toggleRandom()">ğŸ”€</button>
<button onclick="toggleReverse()">ğŸ”„</button>
<button onclick="showExample()">ğŸ’¬</button>
<button onclick="exportExcel()">ğŸ’¾</button>
</div>

<div id="example" class="example"></div>
<div id="counter" class="counter"></div>

</div>

<script>

let workbook;
let cards=[];
let learned={};

let currentSheet="";
let i=0,random=false,reversed=false,front=true;

const frontDiv=document.getElementById("front");
const backDiv=document.getElementById("back");
const exampleDiv=document.getElementById("example");
const counter=document.getElementById("counter");
const favBtn=document.getElementById("favBtn");
const sheetBar=document.getElementById("sheetBar");

upload.onchange=e=>{
let reader=new FileReader();

reader.onload=e=>{
workbook=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
renderSheets();
loadSheet(workbook.SheetNames[0]);
};

reader.readAsArrayBuffer(upload.files[0]);
};

function renderSheets(){
sheetBar.innerHTML="";

workbook.SheetNames.forEach((name,index)=>{
let b=document.createElement("button");
b.className="sheetBtn"+(index==0?" active":"");
b.innerText=name;
b.onclick=()=>loadSheet(name);
sheetBar.appendChild(b);
});
}

function loadSheet(name){

currentSheet=name;

document.querySelectorAll(".sheetBtn")
.forEach(b=>b.classList.toggle("active",b.innerText===name));

let rows=XLSX.utils.sheet_to_json(
workbook.Sheets[name],
{header:1}
);

cards=[];

let header=rows[0]||[];

let apprisIndex=header.findIndex(h=>String(h).toLowerCase()=="appris");

rows.forEach((r,index)=>{

if(index===0)return;

if(r[0]&&r[1]){

cards.push({
en:r[0],
fr:r[1],
ex:r[2]||"",
row:index
});

if(apprisIndex>=0 && r[apprisIndex]=="X"){
learned[name+"_"+index]=true;
}

}

});

i=0;
show();
}

function show(){

front=true;

frontDiv.innerText=reversed?cards[i].fr:cards[i].en;
backDiv.innerText="";
exampleDiv.innerText="";

updateFavButton();

counter.innerText=(i+1)+" / "+cards.length;

autoSpeak();
}

function updateFavButton(){

let key=currentSheet+"_"+cards[i].row;

if(learned[key])
favBtn.classList.add("favorite");
else
favBtn.classList.remove("favorite");
}

function toggleFavorite(){

let key=currentSheet+"_"+cards[i].row;

learned[key]=!learned[key];

updateFavButton();
}

card.onclick=()=>{
front=!front;
frontDiv.innerText=
front
?(reversed?cards[i].fr:cards[i].en)
:(reversed?cards[i].en:cards[i].fr);
};

function next(){
i=random?Math.floor(Math.random()*cards.length):(i+1)%cards.length;
show();
}

function prev(){
i=(i-1+cards.length)%cards.length;
show();
}

function toggleRandom(){random=!random}
function toggleReverse(){reversed=!reversed;show()}

function speak(){
let u=new SpeechSynthesisUtterance(frontDiv.innerText);
u.lang=reversed?"fr-FR":"en-US";
speechSynthesis.speak(u);
}

function autoSpeak(){setTimeout(speak,120)}

function showExample(){
exampleDiv.innerText=cards[i].ex;
}

function exportExcel(){

let wb=XLSX.utils.book_new();

workbook.SheetNames.forEach(name=>{

let rows=XLSX.utils.sheet_to_json(
workbook.Sheets[name],
{header:1}
);

if(!rows[0].includes("Appris"))
rows[0].push("Appris");

let apprisIndex=rows[0].indexOf("Appris");

rows.forEach((r,index)=>{
let key=name+"_"+index;
if(learned[key]) r[apprisIndex]="X";
});

let ws=XLSX.utils.aoa_to_sheet(rows);
XLSX.utils.book_append_sheet(wb,ws,name);

});

XLSX.writeFile(wb,"flashcards_appris.xlsx");
}

</script>

</body>
</html>
