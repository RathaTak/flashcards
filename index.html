<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Flashcards</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{--main:#6c63ff}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
background:linear-gradient(160deg,#0f1222,#1c1f3a);
height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:white;
}

.app{width:100%;max-width:420px;padding:20px}

.sheetBar{
display:flex;
gap:8px;
overflow-x:auto;
margin-bottom:10px;
}

.sheetBtn{
padding:8px 12px;
border-radius:12px;
background:#ffffff20;
border:none;
color:white;
}

.sheetBtn.active{background:var(--main)}

.card{
background:white;
border-radius:22px;
padding:25px;
text-align:center;
min-height:180px;
display:flex;
flex-direction:column;
justify-content:center;
box-shadow:0 15px 40px rgba(0,0,0,.4);
cursor:pointer;
position:relative;
}

.word{font-size:30px;font-weight:600;color:var(--main)}
.translation{font-size:22px;color:black;margin-top:8px}

.controls,.row{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:10px;
margin-top:12px;
}

button{
border:none;
border-radius:14px;
padding:14px;
background:#ffffff20;
color:white;
font-size:18px;
}

.active{background:var(--main)!important}

.example{margin-top:10px;min-height:40px}
.counter{text-align:center;margin-top:6px;font-size:13px;opacity:.6}

.hidden{display:none}

.star{
position:absolute;
top:12px;
right:16px;
font-size:22px;
}
</style>
</head>

<body>

<div class="app">

<input type="file" id="upload">

<div id="sheetBar" class="sheetBar"></div>

<div id="card" class="card">
<div id="star" class="star hidden">‚≠ê</div>
<div id="english" class="word">Charge ton Excel</div>
<div id="french" class="translation hidden"></div>
</div>

<div class="controls">
<button onclick="prev()">‚¨Ö</button>
<button onclick="speak()">üîä</button>
<button onclick="next()">‚û°</button>
</div>

<div class="row">
<button id="randomBtn" onclick="toggleRandom()">üîÄ</button>
<button id="reverseBtn" onclick="toggleReverse()">üîÑ</button>
<button onclick="showExample()">üí¨</button>
</div>

<div class="row">
<button id="toggleLearnedBtn" onclick="toggleLearned()">üëÅ</button>
<button id="learnedOnlyBtn" onclick="toggleLearnedOnly()">üéØ</button>
</div>

<div id="example" class="example"></div>
<div id="counter" class="counter"></div>

</div>

<script>
let workbook;
let allCards=[];
let cards=[];
let i=0;

let random=false;
let reversed=false;
let showLearned=false;
let learnedOnly=false;

const english=document.getElementById("english");
const french=document.getElementById("french");
const example=document.getElementById("example");
const counter=document.getElementById("counter");
const star=document.getElementById("star");

const randomBtn=document.getElementById("randomBtn");
const reverseBtn=document.getElementById("reverseBtn");
const toggleLearnedBtn=document.getElementById("toggleLearnedBtn");
const learnedOnlyBtn=document.getElementById("learnedOnlyBtn");
const sheetBar=document.getElementById("sheetBar");
const upload=document.getElementById("upload");
const card=document.getElementById("card");

upload.onchange=e=>{
let r=new FileReader();
r.onload=e=>{
workbook=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
renderSheets();
loadSheet(workbook.SheetNames[0]);
};
r.readAsArrayBuffer(upload.files[0]);
};

function renderSheets(){
sheetBar.innerHTML="";
workbook.SheetNames.forEach((n,k)=>{
let b=document.createElement("button");
b.className="sheetBtn"+(k==0?" active":"");
b.innerText=n;
b.onclick=()=>loadSheet(n);
sheetBar.appendChild(b);
});
}

function loadSheet(name){
document.querySelectorAll(".sheetBtn")
.forEach(b=>b.classList.toggle("active",b.innerText===name));

let rows=XLSX.utils.sheet_to_json(workbook.Sheets[name],{header:1});

allCards=[];

rows.forEach(r=>{
if(!r[0]||!r[1]) return;

let appris=(r[3]||"").toString().toLowerCase();
let learned=appris==="x"||appris==="‚úì"||appris==="‚úî"||appris==="oui";

allCards.push({
en:r[0],
fr:r[1],
ex:r[2]||"",
learned:learned
});
});

applyFilters();
}

function applyFilters(){
cards=allCards.filter(c=>{
if(learnedOnly) return c.learned;
if(!showLearned && c.learned) return false;
return true;
});

i=0;
update();
}

function update(){
if(!cards.length){
english.innerText="Aucun mot";
french.classList.add("hidden");
star.classList.add("hidden");
return;
}

let c=cards[i];

english.innerText=reversed?c.fr:c.en;
french.innerText=reversed?c.en:c.fr;
french.classList.add("hidden");

example.innerText="";
counter.innerText=(i+1)+" / "+cards.length;

/* ‚≠ê affiche si appris */
if(c.learned){
star.classList.remove("hidden");
}else{
star.classList.add("hidden");
}

/* üîä audio automatique */
autoSpeak();
}

function autoSpeak(){
let text=reversed?cards[i].fr:cards[i].en;
let u=new SpeechSynthesisUtterance(text);
u.lang=reversed?"fr-FR":"en-US";
speechSynthesis.cancel();
speechSynthesis.speak(u);
}

card.onclick=()=>{french.classList.toggle("hidden");};
function speak(){autoSpeak();}
function next(){i=random?Math.floor(Math.random()*cards.length):(i+1)%cards.length;update();}
function prev(){i=(i-1+cards.length)%cards.length;update();}

function toggleRandom(){
random=!random;
randomBtn.classList.toggle("active",random);
}

function toggleReverse(){
reversed=!reversed;
reverseBtn.classList.toggle("active",reversed);
update();
}

function toggleLearned(){
showLearned=!showLearned;
toggleLearnedBtn.classList.toggle("active",showLearned);
learnedOnly=false;
learnedOnlyBtn.classList.remove("active");
applyFilters();
}

function toggleLearnedOnly(){
learnedOnly=!learnedOnly;
learnedOnlyBtn.classList.toggle("active",learnedOnly);
if(learnedOnly){
showLearned=true;
toggleLearnedBtn.classList.add("active");
}
applyFilters();
}

function showExample(){
let phrase=cards[i].ex;
example.innerText=phrase;
if(!phrase) return;
let u=new SpeechSynthesisUtterance(phrase);
u.lang=reversed?"fr-FR":"en-US";
speechSynthesis.speak(u);
}
</script>

</body>
</html>
