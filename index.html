<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Flashcards</title>

<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

:root{
--main:#6c63ff;
--bg:#0f1222;
--card:#ffffff;
}

*{box-sizing:border-box}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
background:linear-gradient(160deg,#0f1222,#1c1f3a);
height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:white;
overflow:hidden;
}

.app{
width:100%;
max-width:420px;
padding:20px;
}

h2{text-align:center;font-weight:500;opacity:.8}

input{width:100%;margin:10px 0;}

.sheetBar{
display:flex;
gap:8px;
overflow-x:auto;
margin:10px 0;
}

.sheetBtn{
white-space:nowrap;
padding:8px 12px;
border-radius:12px;
background:#ffffff20;
font-size:13px;
}

.sheetBtn.active{
background:var(--main);
}

.card{
background:var(--card);
color:#111;
border-radius:22px;
min-height:180px;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
padding:20px;
font-size:30px;
font-weight:600;
box-shadow:0 15px 40px rgba(0,0,0,.4);
transition:.25s ease;
touch-action:none;
}

.word{color:var(--main);}
.translation{font-size:22px;font-weight:400;margin-top:10px;}

.controls{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:12px;
margin-top:15px;
}

.row{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:10px;
margin-top:10px;
}

button{
border:none;
border-radius:14px;
padding:14px;
font-size:18px;
background:#ffffff20;
color:white;
}

button:active{transform:scale(.95)}

.active{
background:var(--main)!important;
}

.example{margin-top:12px;font-size:14px;opacity:.8;min-height:40px;}
.counter{text-align:center;margin-top:8px;font-size:13px;opacity:.6;}

.fade{animation:fade .25s;}

@keyframes fade{
from{opacity:0;transform:scale(.95)}
to{opacity:1;transform:scale(1)}
}

</style>
</head>

<body>

<div class="app">

<h2>Flashcards</h2>

<input type="file" id="upload">

<div id="sheetBar" class="sheetBar"></div>

<div id="card" class="card">
<div id="text" class="word">Charge ton Excel</div>
<div id="translation" class="translation"></div>
</div>

<div class="controls">
<button onclick="prev()">â¬…</button>
<button onclick="speak()">ðŸ”Š</button>
<button onclick="next()">âž¡</button>
</div>

<div class="row">
<button id="randomBtn" onclick="toggleRandom()">ðŸ”€</button>
<button id="reverseBtn" onclick="toggleReverse()">ðŸ”„</button>
<button onclick="exampleOnline()">ðŸ’¬</button>
</div>

<div id="example" class="example"></div>
<div id="counter" class="counter"></div>

</div>

<script>

let workbook;
let cards=[];
let i=0;
let random=false;
let reversed=false;
let front=true;

const sheetBar=document.getElementById("sheetBar");
const card=document.getElementById("card");
const text=document.getElementById("text");
const counter=document.getElementById("counter");
const example=document.getElementById("example");
const randomBtn=document.getElementById("randomBtn");
const reverseBtn=document.getElementById("reverseBtn");

upload.addEventListener("change",e=>{
let r=new FileReader();
r.onload=e=>{
let d=new Uint8Array(e.target.result);
workbook=XLSX.read(d,{type:"array"});
renderSheets();
loadSheet(workbook.SheetNames[0]);
};
r.readAsArrayBuffer(e.target.files[0]);
});

function renderSheets(){
sheetBar.innerHTML="";
workbook.SheetNames.forEach((name,idx)=>{
let b=document.createElement("button");
b.className="sheetBtn";
b.innerText=name;
b.onclick=()=>loadSheet(name);
if(idx===0)b.classList.add("active");
sheetBar.appendChild(b);
});
}

function loadSheet(name){

document.querySelectorAll(".sheetBtn").forEach(b=>{
b.classList.toggle("active",b.innerText===name);
});

let sh=workbook.Sheets[name];
let rows=XLSX.utils.sheet_to_json(sh,{header:1});

cards=[];
rows.forEach(r=>{
if(r.length>=2 && r[0] && r[1]){
cards.push([r[0],r[1]]);
}
});

i=0;
show();
}

function frontText(){return reversed?cards[i][1]:cards[i][0];}
function backText(){return reversed?cards[i][0]:cards[i][1];}

function show(){
card.classList.add("fade");
setTimeout(()=>card.classList.remove("fade"),200);
text.innerText=frontText();
text.className="word";
example.innerText="";
counter.innerText=(i+1)+" / "+cards.length;
autoSpeak();
}

card.onclick=()=>{text.innerText=text.innerText===frontText()?backText():frontText();};

function next(){
i=random?Math.floor(Math.random()*cards.length):(i+1)%cards.length;
show();
}

function prev(){
i=(i-1+cards.length)%cards.length;
show();
}

function toggleRandom(){
random=!random;
randomBtn.classList.toggle("active",random);
}

function toggleReverse(){
reversed=!reversed;
reverseBtn.classList.toggle("active",reversed);
show();
}

function speak(){
let u=new SpeechSynthesisUtterance(frontText());
u.lang=reversed?"fr-FR":"en-US";
speechSynthesis.speak(u);
}

function autoSpeak(){setTimeout(speak,150);}

/* Swipe */
let startX=0;
card.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
card.addEventListener("touchend",e=>{
let dx=e.changedTouches[0].clientX-startX;
if(dx>60) prev();
if(dx<-60) next();
});

/* Exemple rÃ©el */
async function exampleOnline(){
if(!navigator.onLine)return;
let w=cards[i][0].toLowerCase();
try{
let r=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${w}`);
let j=await r.json();
for(let m of j[0].meanings){
for(let d of m.definitions){
if(d.example){
example.innerText=d.example;
let u=new SpeechSynthesisUtterance(d.example);
u.lang="en-US";
speechSynthesis.speak(u);
return;
}
}
}
}catch(e){}
}

if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}

</script>

</body>
</html>
